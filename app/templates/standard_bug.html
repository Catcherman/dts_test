{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}D T S-New Bug{% endblock %}

{% block page_content %}
<div class="col-md-4">

    <form action="newbugs" method="post" enctype="multipart/form-data" id='form1'>
        {{ form.hidden_tag() }}
        {{ wtf.form_field(form.bugs_id) }}
        {{ wtf.form_field(form.product_name) }}
        {{ wtf.form_field(form.product_version) }}
        {{ wtf.form_field(form.software_version) }}
        {{ wtf.form_field(form.version_features) }}
        {{ wtf.form_field(form.bug_level) }}
        {{ wtf.form_field(form.system_view) }}
        {{ wtf.form_field(form.bug_show_times) }}
        {{ wtf.form_field(form.bug_title) }}
        {{ wtf.form_field(form.bug_descrit) }}
        {{ wtf.form_field(form.bug_owner_id) }}
        {{ wtf.form_field(form.bug_status) }}
        {{ wtf.form_field(form.attachment)  }}
        <div id="attachmentdiv"></div>
        {{ wtf.form_field(form.submit)  }}
    <br>

</form>
</div>
</div>
</div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
{{ moment.include_moment() }}
{{ pagedown.include_pagedown() }}

<script src="static/check_user.js" type="text/javascript"></script>
<script src="static/standard_bug1.js" type="text/javascript"></script>
<script>
$('#attachment').change(function(){
    //var form_data = new FormData($('#form1')[0]);
    //form_data.append('bugs_id', $('#bugs_id').val());
    var form_data = new FormData();
    form_data.append('bugs_id',$('#bugs_id').val());
    form_data.append('attachment',$('#attachment')[0].files[0]);
    //alert($("#bugs_id").val());
    //alert(form_data);
    //$('#form1')是个list，所以要得到form必须用下标取
    $.ajax({
        url: '/upload',
        type: 'POST',
        data: form_data,
        contentType: false,
        processData: false,
        success: function(fileinfo){
            ss = "<p><span id=" + fileinfo.symlink + ">" +
                 '<input type="text" class="form-control" name=' +
                 fileinfo.filename + ' value='+fileinfo.filename +
                 ' readonly="readonly"></span></p>'

            $('#attachmentdiv').append(ss)
        },
    });
})



</script>
{% endblock %}



